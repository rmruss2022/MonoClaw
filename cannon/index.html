<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸŽ‰ CANNON CELEBRATION ðŸŽ‰</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      overflow: hidden;
    }
    
    .container {
      text-align: center;
      position: relative;
      z-index: 10;
    }
    
    /* Click to start overlay */
    .click-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      cursor: pointer;
      backdrop-filter: blur(10px);
    }
    
    .click-overlay.hidden {
      display: none;
    }
    
    .click-message {
      color: white;
      font-size: 2rem;
      font-weight: bold;
      text-shadow: 0 4px 20px rgba(0,0,0,0.5);
      animation: pulse 1.5s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    /* Cannon styles */
    .cannon-wrapper {
      width: 300px;
      height: 200px;
      margin: 0 auto 2rem;
      position: relative;
    }
    
    .cannon-base {
      width: 100px;
      height: 50px;
      background: linear-gradient(to bottom, #4a5568, #2d3748);
      border-radius: 10px;
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    
    .cannon-barrel {
      width: 150px;
      height: 40px;
      background: linear-gradient(to right, #718096, #4a5568);
      border-radius: 20px;
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%) rotate(-15deg);
      transform-origin: left center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    
    .cannon-barrel.firing {
      animation: recoil 0.3s ease;
    }
    
    @keyframes recoil {
      0%, 100% { transform: translateX(-50%) rotate(-15deg); }
      50% { transform: translateX(-70%) rotate(-20deg); }
    }
    
    .cannon-ball {
      width: 30px;
      height: 30px;
      background: radial-gradient(circle at 30% 30%, #2d3748, #000);
      border-radius: 50%;
      position: absolute;
      top: 50px;
      left: 50%;
      opacity: 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }
    
    .cannon-ball.firing {
      animation: fire 1.2s ease-out forwards;
    }
    
    @keyframes fire {
      0% {
        opacity: 1;
        transform: translate(0, 0) scale(1);
      }
      70% {
        opacity: 1;
      }
      100% {
        opacity: 0;
        transform: translate(400px, -200px) scale(0.5) rotate(720deg);
      }
    }
    
    .explosion {
      position: absolute;
      top: -120px;
      right: -100px;
      font-size: 120px;
      opacity: 0;
      filter: drop-shadow(0 0 20px rgba(255,100,0,0.8));
    }
    
    .explosion.active {
      animation: explode 0.8s ease-out forwards;
    }
    
    @keyframes explode {
      0% {
        opacity: 0;
        transform: scale(0) rotate(0deg);
      }
      30% {
        opacity: 1;
        transform: scale(1.3) rotate(20deg);
      }
      100% {
        opacity: 0;
        transform: scale(2.5) rotate(40deg);
      }
    }
    
    .flash {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.9);
      opacity: 0;
      pointer-events: none;
      z-index: 9999;
    }
    
    .flash.active {
      animation: flash 0.6s ease-out;
    }
    
    @keyframes flash {
      0%, 100% { opacity: 0; }
      50% { opacity: 1; }
    }
    
    .congrats-text {
      font-size: 4rem;
      font-weight: 900;
      background: linear-gradient(45deg, #f59e0b, #ef4444, #ec4899, #8b5cf6, #3b82f6, #10b981);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      opacity: 0;
      margin-bottom: 2rem;
      text-shadow: 0 0 40px rgba(255,255,255,0.9);
      filter: drop-shadow(0 0 20px rgba(255,255,255,0.8));
      -webkit-text-stroke: 2px rgba(255,255,255,0.3);
      position: relative;
    }
    
    .congrats-text::before {
      content: 'ðŸŽ‰ CONGRATS! ðŸŽ‰';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: blur(4px);
      z-index: -1;
    }
    
    .congrats-text.show {
      animation: rainbow 2s ease infinite, fadeIn 0.6s ease forwards;
    }
    
    @keyframes rainbow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes fadeIn {
      from { 
        opacity: 0; 
        transform: scale(0.5) translateY(50px);
      }
      to { 
        opacity: 1; 
        transform: scale(1) translateY(0);
      }
    }
    
    .message {
      color: white;
      font-size: 1.5rem;
      margin-bottom: 2rem;
      opacity: 0;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .message.show {
      animation: fadeIn 0.6s ease 0.3s forwards;
    }
    
    .close-btn {
      padding: 1rem 2rem;
      font-size: 1.1rem;
      font-weight: 600;
      color: white;
      background: rgba(0,0,0,0.3);
      border: 2px solid white;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
      opacity: 0;
    }
    
    .close-btn.show {
      animation: fadeIn 0.6s ease 0.6s forwards;
    }
    
    .close-btn:hover {
      background: rgba(255,255,255,0.2);
      transform: scale(1.05);
    }
    
    .countdown {
      color: rgba(255,255,255,0.6);
      font-size: 0.9rem;
      margin-top: 1rem;
      opacity: 0;
    }
    
    .countdown.show {
      animation: fadeIn 0.6s ease 0.9s forwards;
    }
    
    /* Confetti */
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: #f59e0b;
      position: absolute;
      opacity: 0;
    }
    
    .confetti.active {
      animation: confettiFall 3s ease-out forwards;
    }
    
    @keyframes confettiFall {
      0% {
        opacity: 1;
        transform: translateY(0) rotate(0deg);
      }
      100% {
        opacity: 0;
        transform: translateY(100vh) rotate(720deg);
      }
    }
  </style>
</head>
<body>
  <!-- Click to start overlay -->
  <div class="click-overlay" id="clickOverlay">
    <div class="click-message">ðŸŽ‰ CLICK TO START ðŸŽ‰</div>
  </div>
  
  <div class="container">
    <div class="cannon-wrapper">
      <div class="cannon-barrel" id="barrel"></div>
      <div class="cannon-base"></div>
      <div class="cannon-ball" id="ball"></div>
      <div class="explosion" id="explosion">ðŸ’¥</div>
    </div>
    
    <div class="congrats-text" id="congrats">ðŸŽ‰ CONGRATS! ðŸŽ‰</div>
    <div class="message" id="message">You did it! ðŸ¦ž</div>
    
    <button class="close-btn" id="closeBtn" onclick="window.close()">
      Close
    </button>
    
    <div class="countdown" id="countdown">Auto-closes in <span id="timer">90</span>s</div>
  </div>
  
  <div class="flash" id="flash"></div>
  
  <script>
    // Cannon fire sequence
    let stage = 'ready';
    let timeLeft = 90;
    let countdownInterval;
    let audioContext = null;
    let started = false;
    
    function playExplosionSound() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      
      try {
        const now = audioContext.currentTime;
        
        // Bass rumble (LOUDER)
        const bass = audioContext.createOscillator();
        const bassGain = audioContext.createGain();
        bass.type = 'sawtooth';
        bass.frequency.setValueAtTime(50, now);
        bass.frequency.exponentialRampToValueAtTime(20, now + 0.6);
        bassGain.gain.setValueAtTime(2.5, now); // MUCH LOUDER
        bassGain.gain.exponentialRampToValueAtTime(0.01, now + 0.6);
        bass.connect(bassGain);
        bassGain.connect(audioContext.destination);
        bass.start(now);
        bass.stop(now + 0.6);
        
        // High frequency crack (LOUDER)
        const crack = audioContext.createOscillator();
        const crackGain = audioContext.createGain();
        crack.type = 'square';
        crack.frequency.setValueAtTime(1500, now);
        crack.frequency.exponentialRampToValueAtTime(80, now + 0.2);
        crackGain.gain.setValueAtTime(1.5, now); // LOUDER
        crackGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
        crack.connect(crackGain);
        crackGain.connect(audioContext.destination);
        crack.start(now);
        crack.stop(now + 0.2);
        
        // White noise burst (LOUDER)
        const bufferSize = audioContext.sampleRate * 0.5;
        const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
          data[i] = Math.random() * 2 - 1;
        }
        const noise = audioContext.createBufferSource();
        const noiseGain = audioContext.createGain();
        noise.buffer = buffer;
        noiseGain.gain.setValueAtTime(1.2, now); // LOUDER
        noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
        noise.connect(noiseGain);
        noiseGain.connect(audioContext.destination);
        noise.start(now);
        
        console.log('ðŸ”Š EXPLOSION SOUND PLAYED! Volume levels increased.');
      } catch (err) {
        console.error('âŒ Audio playback failed:', err);
        alert('Sound failed to play. Error: ' + err.message);
      }
    }
    
    function playImpactExplosion() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      
      try {
        const now = audioContext.currentTime;
        
        // MASSIVE bass explosion (even lower frequency)
        const bass = audioContext.createOscillator();
        const bassGain = audioContext.createGain();
        bass.type = 'sawtooth';
        bass.frequency.setValueAtTime(30, now);
        bass.frequency.exponentialRampToValueAtTime(10, now + 0.8);
        bassGain.gain.setValueAtTime(3.5, now); // MASSIVE VOLUME
        bassGain.gain.exponentialRampToValueAtTime(0.01, now + 0.8);
        bass.connect(bassGain);
        bassGain.connect(audioContext.destination);
        bass.start(now);
        bass.stop(now + 0.8);
        
        // Sharp impact crack
        const crack = audioContext.createOscillator();
        const crackGain = audioContext.createGain();
        crack.type = 'square';
        crack.frequency.setValueAtTime(2000, now);
        crack.frequency.exponentialRampToValueAtTime(50, now + 0.15);
        crackGain.gain.setValueAtTime(2.0, now);
        crackGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
        crack.connect(crackGain);
        crackGain.connect(audioContext.destination);
        crack.start(now);
        crack.stop(now + 0.15);
        
        // Massive white noise explosion
        const bufferSize = audioContext.sampleRate * 0.7;
        const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
          data[i] = Math.random() * 2 - 1;
        }
        const noise = audioContext.createBufferSource();
        const noiseGain = audioContext.createGain();
        noise.buffer = buffer;
        noiseGain.gain.setValueAtTime(1.8, now); // HUGE VOLUME
        noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.7);
        noise.connect(noiseGain);
        noiseGain.connect(audioContext.destination);
        noise.start(now);
        
        console.log('ðŸ’¥ IMPACT EXPLOSION SOUND PLAYED!');
      } catch (err) {
        console.error('âŒ Impact explosion sound failed:', err);
      }
    }
    
    function createConfetti() {
      const colors = ['#f59e0b', '#ef4444', '#ec4899', '#8b5cf6', '#3b82f6', '#10b981', '#fbbf24', '#f97316'];
      const confettiCount = 250; // INCREASED from 50 to 250
      
      for (let i = 0; i < confettiCount; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.top = '-10px';
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.width = (Math.random() * 15 + 5) + 'px';
          confetti.style.height = (Math.random() * 15 + 5) + 'px';
          confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
          document.body.appendChild(confetti);
          
          setTimeout(() => {
            confetti.classList.add('active');
            setTimeout(() => confetti.remove(), 3000);
          }, 10);
        }, i * 20); // Faster spawn rate
      }
    }
    
    function startCountdown() {
      countdownInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(countdownInterval);
          window.close();
        }
      }, 1000);
    }
    
    function startCelebration() {
      if (started) return;
      started = true;
      
      // Hide click overlay
      document.getElementById('clickOverlay').classList.add('hidden');
      
      // Initialize audio context on user interaction
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      
      console.log('ðŸŽ‰ Starting celebration...');
      
      // Fire sequence after 2 seconds
      setTimeout(() => {
        stage = 'firing';
        
        console.log('ðŸ”¥ Firing cannon...');
        
        // Fire cannon
        document.getElementById('barrel').classList.add('firing');
        document.getElementById('ball').classList.add('firing');
        
        // Play explosion sound immediately
        console.log('ðŸ”Š Playing explosion sound...');
        playExplosionSound();
        
        // Explosion at 0.9s
        setTimeout(() => {
          console.log('ðŸ’¥ Explosion!');
          
          // Play SECOND explosion sound (impact)
          playImpactExplosion();
          
          document.getElementById('explosion').classList.add('active');
          document.getElementById('flash').classList.add('active');
          
          setTimeout(() => {
            document.getElementById('flash').classList.remove('active');
          }, 600);
          
          stage = 'exploded';
          
          // Show congrats text
          setTimeout(() => {
            console.log('âœ¨ Showing congrats...');
            document.getElementById('congrats').classList.add('show');
            document.getElementById('message').classList.add('show');
            document.getElementById('closeBtn').classList.add('show');
            document.getElementById('countdown').classList.add('show');
            
            // Create confetti
            createConfetti();
            
            // Start countdown
            startCountdown();
          }, 300);
        }, 900);
      }, 2000);
    }
    
    // Click overlay to start
    document.getElementById('clickOverlay').addEventListener('click', startCelebration);
    
    // Keyboard shortcut to close (Escape)
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        clearInterval(countdownInterval);
        window.close();
      }
    });
    
    console.log('ðŸ¦ž Cannon celebration loaded. Click to start!');
  </script>
</body>
</html>
