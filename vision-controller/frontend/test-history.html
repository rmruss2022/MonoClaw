<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesture History - Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #fff;
            padding: 40px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        h1 {
            margin-bottom: 30px;
            text-align: center;
        }
        
        .test-controls {
            background: #2d2d2d;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-controls h2 {
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.2s ease;
        }
        
        .btn-test {
            background: #4caf50;
            color: #fff;
        }
        
        .btn-test:hover {
            background: #45a049;
        }
        
        .btn-clear {
            background: #f44336;
            color: #fff;
        }
        
        .btn-clear:hover {
            background: #d32f2f;
        }
        
        .btn-export {
            background: #2196f3;
            color: #fff;
        }
        
        .btn-export:hover {
            background: #1976d2;
        }
        
        .history-panel {
            background: #2d2d2d;
            border-radius: 12px;
            padding: 20px;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .history-list {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .history-item {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 3px solid transparent;
        }
        
        .history-item.high-confidence {
            border-left-color: #4caf50;
        }
        
        .history-item.medium-confidence {
            border-left-color: #ffc107;
        }
        
        .history-item.low-confidence {
            border-left-color: #f44336;
        }
        
        .history-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
        }
        
        .history-gesture {
            font-weight: 600;
            font-size: 15px;
            color: #4caf50;
        }
        
        .history-confidence {
            font-size: 13px;
            padding: 3px 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .history-item-footer {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #888;
        }
        
        .history-empty {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .stats {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Gesture History Test</h1>
        
        <div class="test-controls">
            <h2>Test Controls</h2>
            <button class="btn-test" onclick="addTestGesture('peace', 0.95)">Add Peace (95%)</button>
            <button class="btn-test" onclick="addTestGesture('thumbs_up', 0.87)">Add Thumbs Up (87%)</button>
            <button class="btn-test" onclick="addTestGesture('fist', 0.72)">Add Fist (72%)</button>
            <button class="btn-test" onclick="addTestGesture('point', 0.65)">Add Point (65%)</button>
            <button class="btn-test" onclick="addTestGesture('stop', 0.58)">Add Stop (58%)</button>
            <button class="btn-test" onclick="addRandomGestures(10)">Add 10 Random</button>
        </div>
        
        <div class="stats" id="stats">
            Total entries: 0 / 20 max
        </div>
        
        <div class="history-panel">
            <div class="history-header">
                <h2>üìú History Log</h2>
                <div>
                    <button class="btn-export" onclick="exportHistory()">Export</button>
                    <button class="btn-clear" onclick="clearHistory()">Clear</button>
                </div>
            </div>
            <div class="history-list" id="history-list">
                <div class="history-empty">No gestures detected yet</div>
            </div>
        </div>
    </div>
    
    <script>
        let gestureHistory = [];
        const MAX_HISTORY_ENTRIES = 20;
        const gestures = ['peace', 'thumbs_up', 'fist', 'point', 'stop'];
        const hands = ['Left', 'Right'];
        
        // Load history on init
        function init() {
            loadGestureHistory();
        }
        
        // Load from localStorage
        function loadGestureHistory() {
            try {
                const stored = localStorage.getItem('gestureHistory');
                if (stored) {
                    gestureHistory = JSON.parse(stored);
                }
                renderHistory();
            } catch (error) {
                console.error('Failed to load:', error);
                gestureHistory = [];
                renderHistory();
            }
        }
        
        // Save to localStorage
        function saveGestureHistory() {
            try {
                localStorage.setItem('gestureHistory', JSON.stringify(gestureHistory));
            } catch (error) {
                console.error('Failed to save:', error);
            }
        }
        
        // Add test gesture
        function addTestGesture(gesture, confidence) {
            const entry = {
                gesture: gesture,
                confidence: confidence,
                hand: hands[Math.floor(Math.random() * hands.length)],
                timestamp: new Date().toISOString(),
                processing_time_ms: Math.floor(Math.random() * 50) + 10
            };
            
            gestureHistory.unshift(entry);
            
            if (gestureHistory.length > MAX_HISTORY_ENTRIES) {
                gestureHistory = gestureHistory.slice(0, MAX_HISTORY_ENTRIES);
            }
            
            saveGestureHistory();
            renderHistory();
        }
        
        // Add random gestures
        function addRandomGestures(count) {
            for (let i = 0; i < count; i++) {
                const gesture = gestures[Math.floor(Math.random() * gestures.length)];
                const confidence = 0.5 + Math.random() * 0.5; // 50-100%
                setTimeout(() => addTestGesture(gesture, confidence), i * 100);
            }
        }
        
        // Render history
        function renderHistory() {
            const listEl = document.getElementById('history-list');
            const statsEl = document.getElementById('stats');
            
            statsEl.textContent = `Total entries: ${gestureHistory.length} / ${MAX_HISTORY_ENTRIES} max`;
            
            if (gestureHistory.length === 0) {
                listEl.innerHTML = '<div class="history-empty">No gestures detected yet</div>';
                return;
            }
            
            listEl.innerHTML = '';
            
            gestureHistory.forEach(entry => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                if (entry.confidence > 0.8) {
                    item.classList.add('high-confidence');
                } else if (entry.confidence > 0.6) {
                    item.classList.add('medium-confidence');
                } else {
                    item.classList.add('low-confidence');
                }
                
                const date = new Date(entry.timestamp);
                const timeStr = date.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit' 
                });
                
                item.innerHTML = `
                    <div class="history-item-header">
                        <span class="history-gesture">${entry.gesture}</span>
                        <span class="history-confidence">${Math.round(entry.confidence * 100)}%</span>
                    </div>
                    <div class="history-item-footer">
                        <span>üïê ${timeStr}</span>
                        <span>‚úã ${entry.hand}</span>
                        <span>‚ö° ${entry.processing_time_ms}ms</span>
                    </div>
                `;
                
                listEl.appendChild(item);
            });
        }
        
        // Clear history
        function clearHistory() {
            if (confirm('Clear all history?')) {
                gestureHistory = [];
                saveGestureHistory();
                renderHistory();
            }
        }
        
        // Export history
        function exportHistory() {
            if (gestureHistory.length === 0) {
                alert('No history to export');
                return;
            }
            
            const dataStr = JSON.stringify(gestureHistory, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            link.download = `gesture-history-${timestamp}.json`;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            console.log('Exported', gestureHistory.length, 'entries');
        }
        
        // Initialize
        init();
    </script>
</body>
</html>
